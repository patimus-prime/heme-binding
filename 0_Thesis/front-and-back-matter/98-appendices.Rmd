`r if(knitr:::is_latex_output()) '\\startappendices'`

`r if(!knitr:::is_latex_output()) '# (APPENDIX) Appendix {-}'` 

<!-- If you feel it necessary to include an appendix, it goes here. The first appendix should include the commands above. -->


# The First Appendix

This first appendix includes an R chunk that was hidden in the document (using `echo = FALSE`) to help with readibility:

**In 02-rmd-basics-code.Rmd**

```{r ref.label='chunk-parts', eval=FALSE, echo = TRUE}
```


These are the HEM figures, which will likely need to be split up to reference properly.

```{r super-figs}
load("mainData.RData")

library(dplyr) 
library(data.table)
library(tidyr)
library(ggplot2) 
library(stringr)
library(knitr)
library(clipr) # Linux) sudo apt-get install xclip ... R)install.packages("clipr")  
source("~/heme-binding/scripts/r/addpdbcol.R")

# this last one was tricky, see comments underneath:
library(kableExtra) 
#install.packages("kableExtra")
# I had to download more stuff, in ubuntu terminal:
# sudo apt-get install libxml2-dev
# sudo apt-get install libssl-dev
# sudo apt-get install libcurl4-openssl-dev #not sure if competely necessary
# sudo apt-get install libfontconfig1-dev

# you could probably also tease out what you're missing from the error messages
# just keep trying to install kableExtra and download what you need, until it works

#get 5A data real quick so we overwrite all DFs it uses, below:
source("~/heme-binding/scripts/r/data5A.R") 
ls5A <- data5A_fn()


### actual code start lol
activeLigand = "HEM"
   
   # AA FReq ----
   rm(tmp5A,tmp7A,tmpBoth)
   head(HEM_aaFreqDf)
   tmp7A <- data.frame(df7A = eval(parse(text=(paste(activeLigand,"_aaFreqDf",sep="")))))
                          #HEM_aaFreqDf)
   tmp5A <- data.frame(df5A = eval(parse(text=(paste("ls5A$",activeLigand,"_5A_aaFreqDf",sep="")))))
   tmp7A$ang = '7'
   tmp5A$ang = '5'
   head(tmp7A)
   tmp7A
   tmp7A %>%
      dplyr::rename(
         df5A.Residue = df7A.Residue
      ) -> tmp7A
   merge(tmp5A,tmp7A,by = 'df5A.Residue') -> tmpBoth
   #alternative: left_join(tmp5A,tmp7A,by='df5A.Residue')
   tmpBoth %>%
      dplyr::rename(
         Residue = df5A.Residue
      ) -> tmpBoth
   tmpBoth
   
   library(reshape) #ONLY LOAD THIS HERE. IF YOU LOAD EALIER,
   # ALL CASE OF RENAME() FROM DPLYR PACKAGE IN ALL SCRIPTS GETS FUCKED UP.
   # PUTTING IT HERE, ONLY BELOW THIS LIBRARY LOAD DO YOU NEED NEED TO SPECIFY DPLYR::XXX
   
   to_plot <- reshape::melt((data.frame(x=tmpBoth$Residue,`Distance_5A`=tmpBoth$df5A.Freq,`Distance_7A`=tmpBoth$df7A.Freq)),id="x")
#   detach("package:reshape", unload=TRUE) #maybe avoid the problem anyway lol
   
   print(ggplot(to_plot,aes(x= reorder(x,-value),y=value,fill=variable)) + 
            geom_bar(stat="identity",position = "identity", alpha=.4) +
            labs(x = "Residue",y="Frequency", title = paste(activeLigand,": AA Frequency",sep='')) +
            scale_fill_discrete(name = "Distance Cutoff"))
   
   # ### VOLUME ####
   
   rm(tmp5A,tmp7A,tmpBoth)
   colName = 'volume_data'
   tmp7A <- data.frame(df7A = eval(parse(text=(paste(activeLigand,"_MERGED_DF$",colName,sep="")))))
   tmp5A <- data.frame(df5A = eval(parse(text=(paste("ls5A$",activeLigand,"_5A_MERGED_DF$",colName,sep="")))))
   tmp7A$Distance_Cutoff = '7A'
   tmp5A$Distance_Cutoff = '5A'
   tmp7A %>%
      dplyr::rename(
         df5A = df7A #hopefuly does not append, rm() should take care of that
      ) -> tmp7A
   tmpBoth <- rbind(tmp5A,tmp7A)
   print(
      ggplot(tmpBoth, aes(x=df5A,fill=Distance_Cutoff,color=)) +
         geom_histogram(position="identity",alpha=0.4)
      + labs(x="Volume (A³)",y="Frequency",title = paste(activeLigand,": Volume (A³)"))
   )
   
   # Ligand Excluded Surface Area 
   
   rm(tmp5A,tmp7A,tmpBoth)
   colName = paste(activeLigand,"_Excluded_SA",sep="")
   tmp7A <- data.frame(df7A = eval(parse(text=(paste(activeLigand,"_MERGED_DF$",colName,sep="")))))
   tmp5A <- data.frame(df5A = eval(parse(text=(paste("ls5A$",activeLigand,"_5A_MERGED_DF$",colName,sep="")))))
   tmp7A$Distance_Cutoff = '7A'
   tmp5A$Distance_Cutoff = '5A'
   tmp7A %>%
      dplyr::rename(
         df5A = df7A #hopefuly does not append, rm() should take care of that
      ) -> tmp7A
   tmpBoth <- rbind(tmp5A,tmp7A)
   print(
      ggplot(tmpBoth, aes(x=df5A,fill=Distance_Cutoff,color=)) +
         geom_histogram(position="identity",alpha=0.4)
      + labs(x="Surface Area (A²)",y="Frequency",title = paste(activeLigand,": Ligand Excluded SA (A²)"))
   )
   
   
   # Ligand Accessible Surface Area 
   
   rm(tmp5A,tmp7A,tmpBoth)
   colName = paste(activeLigand,"_Accessible_SA",sep="")
   tmp7A <- data.frame(df7A = eval(parse(text=(paste(activeLigand,"_MERGED_DF$",colName,sep="")))))
   tmp5A <- data.frame(df5A = eval(parse(text=(paste("ls5A$",activeLigand,"_5A_MERGED_DF$",colName,sep="")))))
   tmp7A$Distance_Cutoff = '7A'
   tmp5A$Distance_Cutoff = '5A'
   tmp7A %>%
      dplyr::rename(
         df5A = df7A #hopefuly does not append, rm() should take care of that
      ) -> tmp7A
   tmpBoth <- rbind(tmp5A,tmp7A)
   print(
      ggplot(tmpBoth, aes(x=df5A,fill=Distance_Cutoff,color=)) +
         geom_histogram(position="identity",alpha=0.4)
      + labs(x="Surface Area (A²)",y="Frequency",title = paste(activeLigand,": Ligand Accessible SA (A²)"))
   )
   
   # Pocket Excluded SA
    
   rm(tmp5A,tmp7A,tmpBoth)
   colName = "Pocket_Excluded_SA"
   tmp7A <- data.frame(df7A = eval(parse(text=(paste(activeLigand,"_MERGED_DF$",colName,sep="")))))
   tmp5A <- data.frame(df5A = eval(parse(text=(paste("ls5A$",activeLigand,"_5A_MERGED_DF$",colName,sep="")))))
   tmp7A$Distance_Cutoff = '7A'
   tmp5A$Distance_Cutoff = '5A'
   tmp7A %>%
      dplyr::rename(
         df5A = df7A #hopefuly does not append, rm() should take care of that
      ) -> tmp7A
   tmpBoth <- rbind(tmp5A,tmp7A)
   print(
      ggplot(tmpBoth, aes(x=df5A,fill=Distance_Cutoff,color=)) +
         geom_histogram(position="identity",alpha=0.4)
      + labs(x="Surface Area A²",y="Frequency",title = paste(activeLigand,": Pocket Excluded SA (A²)"))
   )
   
   
   # Pocket Acessible histo
   rm(tmp5A,tmp7A,tmpBoth)
   colName = "Pocket_Accessible_SA"
   tmp7A <- data.frame(df7A = eval(parse(text=(paste(activeLigand,"_MERGED_DF$",colName,sep="")))))
   tmp5A <- data.frame(df5A = eval(parse(text=(paste("ls5A$",activeLigand,"_5A_MERGED_DF$",colName,sep="")))))
   tmp7A$Distance_Cutoff = '7A'
   tmp5A$Distance_Cutoff = '5A'
   tmp7A %>%
      dplyr::rename(
         df5A = df7A #hopefuly does not append, rm() should take care of that
      ) -> tmp7A
   tmpBoth <- rbind(tmp5A,tmp7A)
   print(
      ggplot(tmpBoth, aes(x=df5A,fill=Distance_Cutoff,color=)) +
         geom_histogram(position="identity",alpha=0.4)
      + labs(title = paste(activeLigand,"Pocket Acessible SA (A²)"))
   )
   
   
# plots of intersected distances with...
   
   # all planar angles   
   # yeah keep the as.numeric(as.character),easiest way to solve the problem
   planarAllPlot <- ggplot(eval(parse(text=paste(activeLigand,"_allDistPlanarDf",sep=''))),
                           aes(x=Residue_Code.x,y=as.numeric(as.character(Angle)),fill=Residue_Code.x)) +   
      geom_violin(trim=FALSE) +
      labs(title = paste(activeLigand,": All Planar Angles",sep=''), x="Residue",y="Angle")
   print(planarAllPlot)
   
   # closest residues' planar angles
   planarMinPlot <- ggplot(eval(parse(text=paste(activeLigand,"_minDistPlanarDf",sep=''))),
                           aes(x=Residue_Code.x,y=as.numeric(as.character(Angle)),fill=Residue_Code.x)) +
      geom_violin(trim = FALSE) +
      labs(title = paste(activeLigand,": Planar Angles of Closest Residues",sep = ''),x="Residue",y="Angle")
   print(planarMinPlot)
   
   # all cabs with distance intersect
   cabAllPlot <- ggplot(eval(parse(text=paste(activeLigand,"_allDistCabDf",sep=''))),
                        aes(x=Residue_Code.x,y=as.numeric(as.character(Angle)),fill=Residue_Code.x)) +   
      geom_violin(trim=FALSE) +
      labs(title = paste(activeLigand,": All CA-CB-Fe Angles",sep=''), x="Residue",y="Angle")
   print(cabAllPlot)
   
   # cabs for closest 3 residues
   cabMinPlot <- ggplot(eval(parse(text=paste(activeLigand,"_minDistCabDf",sep=''))),
                        aes(x=Residue_Code.x,y=as.numeric(as.character(Angle)),fill=Residue_Code.x)) +   
      geom_violin(trim=FALSE) +
      labs(title = paste(activeLigand,": CA-CB-Fe Angles of Closest Residues",sep=''), x="Residue",y="Angle")
   print(cabMinPlot)
```



**And here's another one from the same chapter, i.e. Chapter \@ref(code):**

<!-- ```{r ref.label='oxford-logo-rotated', eval=FALSE, echo = TRUE} -->
<!-- ``` -->



# The Second Appendix, for Fun

Here we're gonna try out some DANK tables.
```{r amazing-tables}
# declarations

load("mainData.RData")

library(dplyr) 
library(data.table)
library(tidyr)
library(ggplot2) 
library(stringr)
library(knitr)
library(clipr) # Linux) sudo apt-get install xclip ... R)install.packages("clipr")  
source("~/heme-binding/scripts/r/addpdbcol.R")

# this last one was tricky, see comments underneath:
library(kableExtra) 
#install.packages("kableExtra")
# I had to download more stuff, in ubuntu terminal:
# sudo apt-get install libxml2-dev
# sudo apt-get install libssl-dev
# sudo apt-get install libcurl4-openssl-dev #not sure if competely necessary
# sudo apt-get install libfontconfig1-dev

# you could probably also tease out what you're missing from the error messages
# just keep trying to install kableExtra and download what you need, until it works

#get 5A data real quick so we overwrite all DFs it uses, below:
source("~/heme-binding/scripts/r/data5A.R") 
ls5A <- data5A_fn()


### actual code start lol
activeLigand = "HEM"

HEM_p1DF %>%
  kable(longtable = T, booktabs = T, caption = "p1DF") %>%
   kable_styling(full_width = T, latex_options = c("striped","repeat_header"))

HEM_p2DF %>%
  kable(longtable = T, booktabs = T, caption = "p2DF") %>%
   kable_styling(full_width = T, latex_options = c("striped","repeat_header"))
  
```
